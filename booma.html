<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mag Runner - Easter Egg</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .game-container { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            min-height: calc(100vh - 60px); 
            overflow: hidden; 
        }
        /* Increased canvas size for a bigger game world */
        #gameCanvas { 
            background: var(--panel); 
            border: 2px solid var(--border); 
            border-radius: 12px; 
            width: 90vw; 
            max-width: 800px; 
            height: 400px;
            cursor: pointer; 
        }
        .game-ui { text-align: center; margin-top: 15px; }
        .score-board { font-family: 'Courier New', monospace; font-size: 2rem; color: var(--gold); margin-bottom: 10px; }
        .instructions { font-size: 0.9rem; opacity: 0.7; color: var(--text); line-height: 1.6; }
    </style>
</head>
<body>

<nav class="main-nav">
    <div class="nav-links">
        <a href="index.html" class="nav-link">Drop Charts</a>
        <a href="mag.html" class="nav-link">Mag Tool</a>
        <a href="booma.html" class="nav-link active">?</a>
    </div>
</nav>

<div class="game-container">
    <div class="score-board">SCORE: <span id="score">00000</span></div>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <div class="game-ui">
        <p class="instructions">
            <strong>SPACE / TAP</strong>: JUMP (2X) &nbsp; | &nbsp; <strong>HOLD SPACE</strong>: FLOAT<br>
            <strong>SHIFT / DOWN</strong>: DUCK &nbsp; | &nbsp; <strong>Slower Paced Movement</strong>
        </p>
        <button onclick="resetGame()" style="margin-top: 10px; border-color: var(--blue); color: var(--blue); cursor:pointer; padding: 10px 20px;">REBOOT SYSTEM</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');

    let score = 0, gameActive = true, frame = 0, audioCtx;

    // --- PSO SFX ENGINE ---
    function playSfx(freq, type, dur) {
        if (!audioCtx) audioCtx = new AudioContext();
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    // --- TUNED PHYSICS & PLAYER ---
    const player = {
        x: 80, y: 300, w: 40, h: 40, hNormal: 40, hDuck: 20,
        dy: 0, g: 0.3, jumps: 0, maxJumps: 2, 
        isFloating: false, isDucking: false
    };

    const obstacles = [];
    const colors = { mag: '#ff7b72', rappy: '#facc15', booma: '#50fa7b', bird: '#58a6ff', ground: '#30363d' };

    function createObstacle() {
        if (frame % 100 === 0) { // Slower, more rhythmic spawn rate
            const types = ['RAPPY', 'BOOMA', 'GULGUS'];
            const type = types[Math.floor(Math.random() * types.length)];
            let obs = { x: canvas.width, type: type, speed: 3 + (score/1000) }; 
            
            if (type === 'RAPPY') { obs.y = 340; obs.w = 30; obs.h = 30; obs.v = 0; }
            else if (type === 'BOOMA') { obs.y = 320; obs.w = 50; obs.h = 50; obs.v = 0; }
            else { // Flying Gulgus with angled paths
                obs.y = 100 + Math.random() * 150; obs.w = 40; obs.h = 25;
                obs.v = (Math.random() - 0.5) * 2; 
            }
            obstacles.push(obs);
        }
    }

    function update() {
        if (!gameActive) {
            ctx.fillStyle = "rgba(0,0,0,0.8)"; ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = "white"; ctx.font = "bold 24px Arial";
            ctx.fillText("MISSION FAILED - REBOOT SYSTEM", 180, 200);
            return;
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // --- PLAYER LOGIC ---
        player.h = player.isDucking ? player.hDuck : player.hNormal;
        
        // Float logic: Hold space to slow fall
        if (player.isFloating && player.dy > 0) player.dy *= 0.8; 
        
        player.dy += player.g;
        player.y += player.dy;

        // Ground Collision (Floor at 370px)
        if (player.y + player.h > 370) {
            player.y = 370 - player.h; player.dy = 0;
            player.jumps = 0;
        }

        // Draw Player (Mag)
        ctx.fillStyle = colors.mag;
        ctx.beginPath();
        ctx.roundRect(player.x, player.y, player.w, player.h, 8);
        ctx.fill();

        // --- ENEMY VARIATION ---
        obstacles.forEach((o, i) => {
            o.x -= o.speed;
            o.y += (o.v || 0); // Diagonal angles
            
            // Flying boundary bounce
            if (o.type === 'GULGUS' && (o.y < 40 || o.y > 320)) o.v *= -1;

            ctx.fillStyle = colors[o.type === 'GULGUS' ? 'bird' : (o.type === 'RAPPY' ? 'rappy' : 'booma')];
            ctx.fillRect(o.x, o.y, o.w, o.h);

            // Collision Detection
            if (player.x < o.x + o.w && player.x + player.w > o.x &&
                player.y < o.y + o.h && player.y + player.h > o.y) {
                gameActive = false; playSfx(140, 'sawtooth', 0.5);
            }
            if (o.x + o.w < 0) { obstacles.splice(i, 1); score += 10; }
        });

        // Draw Ground Line
        ctx.fillStyle = colors.ground; ctx.fillRect(0, 370, canvas.width, 30);
        
        scoreElement.textContent = score.toString().padStart(5, '0');
        frame++; requestAnimationFrame(update);
    }

    // --- MOVEMENT INPUTS ---
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            if (player.jumps < player.maxJumps) { // Double Jump
                player.dy = -8; player.jumps++;
                playSfx(300 + (player.jumps * 100), 'sine', 0.2);
            }
            player.isFloating = true;
        }
        if (e.code === 'ArrowDown' || e.code === 'ShiftLeft') player.isDucking = true;
    });

    window.addEventListener('keyup', (e) => {
        if (e.code === 'Space') player.isFloating = false;
        if (e.code === 'ArrowDown' || e.code === 'ShiftLeft') player.isDucking = false;
    });

    function resetGame() { 
        score = 0; obstacles.length = 0; gameActive = true; 
        player.y = 300; player.dy = 0; frame = 0; 
        update(); 
    }

    update();
</script>
</body>
</html>
