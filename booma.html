<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mag Runner - Easter Egg</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .game-container { display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: calc(100vh - 60px); overflow: hidden; }
        #gameCanvas { background: var(--panel); border: 2px solid var(--border); border-radius: 12px; max-width: 95%; cursor: pointer; }
        .game-ui { text-align: center; margin-top: 15px; }
        .score-board { font-family: 'Courier New', monospace; font-size: 1.5rem; color: var(--gold); margin-bottom: 10px; }
        .instructions { font-size: 0.8rem; opacity: 0.7; color: var(--text); }
    </style>
</head>
<body>

<nav class="main-nav">
    <div class="nav-links">
        <a href="index.html" class="nav-link">Drop Charts</a>
        <a href="mag.html" class="nav-link">Mag Tool</a>
        <a href="booma.html" class="nav-link active">?</a>
    </div>
</nav>

<div class="game-container">
    <div class="score-board">SCORE: <span id="score">00000</span></div>
    <canvas id="gameCanvas" width="600" height="300"></canvas>
    <div class="game-ui">
        <p class="instructions">SPACE/TAP TO JUMP (2X) • HOLD TO FLOAT • SHIFT/DOWN TO DUCK</p>
        <button onclick="resetGame()" style="margin-top: 10px; border-color: var(--blue); color: var(--blue); cursor:pointer;">REBOOT SYSTEM</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');

    let score = 0, gameActive = true, frame = 0, audioCtx;

    // --- SOUNDS ---
    function playSfx(freq, type, dur) {
        if (!audioCtx) audioCtx = new AudioContext();
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    // --- PHYSICS & PLAYER ---
    const player = {
        x: 50, y: 220, w: 30, h: 30, hNormal: 30, hDuck: 15,
        dy: 0, g: 0.45, jumps: 0, maxJumps: 2, 
        isFloating: false, isDucking: false
    };

    const obstacles = [];
    const colors = { mag: '#ff7b72', rappy: '#facc15', booma: '#50fa7b', bird: '#58a6ff', ground: '#30363d' };

    function createObstacle() {
        if (frame % 70 === 0) {
            const types = ['RAPPY', 'BOOMA', 'GULGUS'];
            const type = types[Math.floor(Math.random() * types.length)];
            let obs = { x: canvas.width, type: type, speed: 5 + (score/500) };
            
            if (type === 'RAPPY') { obs.y = 250; obs.w = 20; obs.h = 20; obs.v = 0; }
            else if (type === 'BOOMA') { obs.y = 240; obs.w = 30; obs.h = 30; obs.v = 0; }
            else { // Flying Gulgus
                obs.y = 150 + Math.random() * 50; obs.w = 25; obs.h = 15;
                obs.v = (Math.random() - 0.5) * 4; // Moves at diagonal angles
            }
            obstacles.push(obs);
        }
    }

    function update() {
        if (!gameActive) {
            ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = "white"; ctx.fillText("MISSION FAILED", 250, 150);
            return;
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // --- PLAYER LOGIC ---
        player.h = player.isDucking ? player.hDuck : player.hNormal;
        
        if (player.isFloating && player.dy > 0) player.dy *= 0.85; // Float effect
        player.dy += player.g;
        player.y += player.dy;

        // Ground Collision
        if (player.y + player.h > 270) {
            player.y = 270 - player.h; player.dy = 0;
            player.jumps = 0;
        }

        // Draw Player (Mag)
        ctx.fillStyle = colors.mag;
        ctx.fillRect(player.x, player.y, player.w, player.h);

        // --- OBSTACLE LOGIC ---
        obstacles.forEach((o, i) => {
            o.x -= o.speed;
            o.y += (o.v || 0);
            ctx.fillStyle = colors[o.type === 'GULGUS' ? 'bird' : (o.type === 'RAPPY' ? 'rappy' : 'booma')];
            ctx.fillRect(o.x, o.y, o.w, o.h);

            // Collision
            if (player.x < o.x + o.w && player.x + player.w > o.x &&
                player.y < o.y + o.h && player.y + player.h > o.y) {
                gameActive = false; playSfx(100, 'square', 0.5);
            }
            if (o.x + o.w < 0) { obstacles.splice(i, 1); score += 10; }
        });

        // Draw Ground
        ctx.fillStyle = colors.ground; ctx.fillRect(0, 270, canvas.width, 30);
        
        scoreElement.textContent = score.toString().padStart(5, '0');
        frame++; requestAnimationFrame(update);
    }

    // --- INPUTS ---
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            if (player.jumps < player.maxJumps) {
                player.dy = -9; player.jumps++;
                playSfx(400 + (player.jumps * 100), 'sine', 0.2);
            }
            player.isFloating = true;
        }
        if (e.code === 'ArrowDown' || e.code === 'ShiftLeft') player.isDucking = true;
    });
    window.addEventListener('keyup', (e) => {
        if (e.code === 'Space') player.isFloating = false;
        if (e.code === 'ArrowDown' || e.code === 'ShiftLeft') player.isDucking = false;
    });

    function resetGame() { score = 0; obstacles.length = 0; gameActive = true; update(); }
    update();
</script>
</body>
</html>
